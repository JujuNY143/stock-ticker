<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Money & Finance Real-Time Ticker</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: transparent;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }

        .ticker-container {
            width: 100%;
            height: 80px;
            background: linear-gradient(45deg, #1a1a2e, #16213e);
            border-top: 2px solid #0f3460;
            border-bottom: 2px solid #0f3460;
            overflow: hidden;
            position: relative;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        .ticker-content {
            display: flex;
            align-items: center;
            height: 100%;
            animation: scroll-left 90s linear infinite;
            white-space: nowrap;
        }

        @keyframes scroll-left {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        .stock-item {
            display: inline-flex;
            align-items: center;
            margin-right: 25px;
            padding: 8px 12px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            backdrop-filter: blur(5px);
            min-width: 160px;
            flex-shrink: 0;
        }

        .news-item {
            display: inline-flex;
            align-items: center;
            margin-right: 30px;
            padding: 10px 16px;
            background: linear-gradient(45deg, rgba(255,69,0,0.3), rgba(255,140,0,0.2));
            border-radius: 8px;
            backdrop-filter: blur(5px);
            min-width: 350px;
            border-left: 4px solid #ff4500;
            flex-shrink: 0;
        }

        .stock-symbol {
            font-weight: bold;
            color: #ffffff;
            font-size: 15px;
            margin-right: 6px;
        }

        .stock-price {
            color: #00d4ff;
            font-size: 13px;
            margin-right: 6px;
        }

        .stock-change {
            font-size: 11px;
            font-weight: bold;
            padding: 2px 5px;
            border-radius: 4px;
        }

        .positive {
            color: #00ff88;
            background: rgba(0,255,136,0.2);
        }

        .negative {
            color: #ff4757;
            background: rgba(255,71,87,0.2);
        }

        .news-icon {
            color: #ff4500;
            margin-right: 8px;
            font-size: 16px;
        }

        .news-text {
            color: #ffffff;
            font-size: 14px;
            font-weight: 500;
        }

        .market-status {
            position: absolute;
            left: 10px;
            bottom: 5px;
            background: rgba(0,0,0,0.9);
            color: #ffffff;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 11px;
            z-index: 100;
            white-space: nowrap;
        }

        .crypto-badge {
            background: linear-gradient(45deg, #f7931a, #ffb347);
            color: #000;
            font-size: 9px;
            padding: 1px 3px;
            border-radius: 3px;
            margin-left: 3px;
        }

        .etf-badge {
            background: linear-gradient(45deg, #32cd32, #90ee90);
            color: #000;
            font-size: 9px;
            padding: 1px 3px;
            border-radius: 3px;
            margin-left: 3px;
        }

        .loading {
            color: #ffffff;
            text-align: center;
            padding: 30px;
            font-size: 16px;
        }

        .real-data-indicator {
            color: #00ff88;
            font-weight: bold;
        }

        .fallback-indicator {
            color: #ff4757;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="ticker-container">
        <div class="ticker-content" id="tickerContent">
            <div class="loading">üìä Loading Money & Finance real-time data...</div>
        </div>
        <div class="market-status" id="marketStatus">üîÑ CONNECTING TO MONEY & FINANCE</div>
    </div>

    <script>
        class AlphaVantageOnlyTicker {
            constructor() {
                // YOUR ALPHA VANTAGE API KEY
                this.apiKey = '1CEUSIYJVLEYZUSP';
                
                this.tickerContent = document.getElementById('tickerContent');
                this.marketStatus = document.getElementById('marketStatus');
                this.newsIndex = 0;
                this.realDataCount = 0;
                this.totalSymbols = 0;
                
                // Stock symbols for Alpha Vantage
                this.stockSymbols = ['AAPL', 'GOOGL', 'MSFT', 'AMZN', 'TSLA', 'NVDA', 'SPY', 'QQQ'];
                
                // Crypto symbols for Alpha Vantage - Using digital currency endpoint
                this.cryptoSymbols = [
                    { symbol: 'BTC', av_symbol: 'BTC' },
                    { symbol: 'ETH', av_symbol: 'ETH' },
                    { symbol: 'ADA', av_symbol: 'ADA' },
                    { symbol: 'DOT', av_symbol: 'DOT' }
                ];
                
                this.news = [
                    "üìä Markets respond to latest economic indicators and Federal Reserve policy decisions",
                    "üöÄ Technology sector continues innovation surge with strong earnings reports",
                    "üí∞ Crypto markets show resilience amid institutional adoption trends",
                    "üì± Major tech companies report record quarterly growth",
                    "‚ö° Energy sector demonstrates stability in changing market conditions",
                    "üíé Digital assets gain momentum among retail and institutional investors",
                    "üåê Global markets react to ongoing geopolitical and economic developments",
                    "üè¶ Financial sector maintains strong performance in current environment"
                ];
                
                this.init();
            }

            async init() {
                console.log('üöÄ Starting Money & Finance ticker...');
                console.log('API Key configured:', this.apiKey !== 'YOUR_API_KEY_HERE' ? '‚úÖ Yes' : '‚ùå Please set your API key');
                
                await this.updateTicker();
                // Update every 15 minutes (Alpha Vantage free tier: 5 calls/minute, 500/day)
                setInterval(() => this.updateTicker(), 900000);
                this.updateMarketStatus();
                setInterval(() => this.updateMarketStatus(), 60000);
            }

            async fetchStockData(symbol) {
                try {
                    const url = `https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${symbol}&apikey=${this.apiKey}`;
                    console.log(`üìà Fetching stock data for ${symbol}...`);
                    
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    console.log(`Alpha Vantage stock response for ${symbol}:`, data);
                    
                    // Check for API errors
                    if (data['Note']) {
                        console.log(`‚ö†Ô∏è API rate limit for ${symbol}:`, data['Note']);
                        return null;
                    }
                    
                    if (data['Error Message']) {
                        console.log(`‚ùå API error for ${symbol}:`, data['Error Message']);
                        return null;
                    }
                    
                    const quote = data['Global Quote'];
                    if (!quote || Object.keys(quote).length === 0) {
                        console.log(`‚ùå No stock quote data for ${symbol}`);
                        return null;
                    }
                    
                    const price = parseFloat(quote['05. price']);
                    const change = parseFloat(quote['09. change']);
                    const changePercent = parseFloat(quote['10. change percent'].replace('%', ''));
                    
                    console.log(`‚úÖ REAL stock data for ${symbol}: $${price.toFixed(2)}`);
                    this.realDataCount++;
                    
                    return {
                        symbol: symbol,
                        price: price.toFixed(2),
                        change: change.toFixed(2),
                        changePercent: changePercent.toFixed(2),
                        isReal: true,
                        type: 'stock'
                    };
                } catch (error) {
                    console.error(`‚ùå Error fetching stock data for ${symbol}:`, error);
                    return null;
                }
            }

            async fetchCryptoData(cryptoItem) {
                try {
                    const url = `https://www.alphavantage.co/query?function=DIGITAL_CURRENCY_DAILY&symbol=${cryptoItem.av_symbol}&market=USD&apikey=${this.apiKey}`;
                    console.log(`üí∞ Fetching crypto data for ${cryptoItem.symbol}...`);
                    
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    console.log(`Money & Finance crypto response for ${cryptoItem.symbol}:`, data);
                    
                    // Check for API errors
                    if (data['Note']) {
                        console.log(`‚ö†Ô∏è API rate limit for ${cryptoItem.symbol}:`, data['Note']);
                        return null;
                    }
                    
                    if (data['Error Message']) {
                        console.log(`‚ùå API error for ${cryptoItem.symbol}:`, data['Error Message']);
                        return null;
                    }
                    
                    const timeSeries = data['Time Series (Digital Currency Daily)'];
                    if (!timeSeries) {
                        console.log(`‚ùå No crypto time series data for ${cryptoItem.symbol}`);
                        return null;
                    }
                    
                    // Get the most recent date's data
                    const dates = Object.keys(timeSeries);
                    const latestDate = dates[0];
                    const latestData = timeSeries[latestDate];
                    
                    const price = parseFloat(latestData['4a. close (USD)']);
                    const open = parseFloat(latestData['1a. open (USD)']);
                    const changePercent = ((price - open) / open * 100).toFixed(2);
                    
                    console.log(`‚úÖ REAL crypto data for ${cryptoItem.symbol}: ${price.toFixed(2)}`);
                    this.realDataCount++;
                    
                    // Format price based on crypto type
                    let formattedPrice;
                    if (cryptoItem.symbol === 'BTC') {
                        formattedPrice = Math.round(price).toLocaleString();
                    } else if (cryptoItem.symbol === 'ETH') {
                        formattedPrice = Math.round(price).toLocaleString();
                    } else {
                        formattedPrice = price.toFixed(2);
                    }
                    
                    return {
                        symbol: cryptoItem.symbol,
                        price: formattedPrice,
                        changePercent: changePercent,
                        isReal: true,
                        type: 'crypto'
                    };
                } catch (error) {
                    console.error(`‚ùå Error fetching crypto data for ${cryptoItem.symbol}:`, error);
                    return null;
                }
            }

            getStockFallbackData(symbol) {
                const fallback = {
                    'AAPL': { price: '195.25', change: '2.15', changePercent: '1.18' },
                    'GOOGL': { price: '175.50', change: '-1.30', changePercent: '-0.74' },
                    'MSFT': { price: '425.90', change: '5.67', changePercent: '1.35' },
                    'AMZN': { price: '185.80', change: '-2.25', changePercent: '-1.20' },
                    'TSLA': { price: '248.75', change: '12.40', changePercent: '5.24' },
                    'NVDA': { price: '138.30', change: '3.60', changePercent: '2.68' },
                    'SPY': { price: '595.30', change: '2.25', changePercent: '0.38' },
                    'QQQ': { price: '508.70', change: '4.80', changePercent: '0.95' }
                };
                
                if (fallback[symbol]) {
                    return { 
                        symbol, 
                        ...fallback[symbol], 
                        isReal: false, 
                        type: 'stock' 
                    };
                }
                return null;
            }

            getCryptoFallbackData(symbol) {
                const fallback = {
                    'BTC': { price: '108,000', changePercent: '1.25' },
                    'ETH': { price: '4,200', changePercent: '2.15' },
                    'ADA': { price: '1.35', changePercent: '0.85' },
                    'DOT': { price: '9.80', changePercent: '1.75' }
                };
                
                if (fallback[symbol]) {
                    return { 
                        symbol, 
                        ...fallback[symbol], 
                        isReal: false, 
                        type: 'crypto' 
                    };
                }
                return null;
            }

            async updateTicker() {
                console.log('=== üîÑ Starting Money & Finance ticker update ===');
                
                this.realDataCount = 0;
                this.totalSymbols = this.stockSymbols.length + this.cryptoSymbols.length;
                const items = [];
                let fallbackCount = 0;
                
                // Fetch stock data with delays to respect rate limits
                for (let i = 0; i < this.stockSymbols.length; i++) {
                    const symbol = this.stockSymbols[i];
                    
                    let stockData = await this.fetchStockData(symbol);
                    
                    if (!stockData) {
                        stockData = this.getStockFallbackData(symbol);
                        fallbackCount++;
                        console.log(`‚ö†Ô∏è Using fallback stock data for ${symbol}`);
                    }
                    
                    if (stockData) {
                        const changeClass = parseFloat(stockData.changePercent) >= 0 ? 'positive' : 'negative';
                        const changeSymbol = parseFloat(stockData.changePercent) >= 0 ? '+' : '';
                        
                        let badge = '';
                        if (['SPY', 'QQQ'].includes(stockData.symbol)) {
                            badge = '<span class="etf-badge">ETF</span>';
                        }
                        
                        const dataIndicator = stockData.isReal ? 
                            '<span class="real-data-indicator">‚óè</span>' : 
                            '<span class="fallback-indicator">‚óè</span>';
                        
                        items.push(`
                            <div class="stock-item">
                                <span class="stock-symbol">${stockData.symbol}${badge}${dataIndicator}</span>
                                <span class="stock-price">$${stockData.price}</span>
                                <span class="stock-change ${changeClass}">
                                    ${changeSymbol}${stockData.change} (${changeSymbol}${stockData.changePercent}%)
                                </span>
                            </div>
                        `);
                    }
                    
                    // Delay between API calls (12 seconds to respect 5 calls/minute limit)
                    if (i < this.stockSymbols.length - 1) {
                        console.log(`‚è±Ô∏è Waiting 12 seconds before next API call...`);
                        await new Promise(resolve => setTimeout(resolve, 12000));
                    }
                }

                // Add news item
                items.push(`
                    <div class="news-item">
                        <span class="news-icon">üì∞</span>
                        <span class="news-text">${this.news[this.newsIndex % this.news.length]}</span>
                    </div>
                `);
                this.newsIndex++;

                // Wait before crypto calls
                console.log(`‚è±Ô∏è Waiting 12 seconds before crypto API calls...`);
                await new Promise(resolve => setTimeout(resolve, 12000));

                // Fetch crypto data with delays
                for (let i = 0; i < this.cryptoSymbols.length; i++) {
                    const cryptoItem = this.cryptoSymbols[i];
                    
                    let cryptoData = await this.fetchCryptoData(cryptoItem);
                    
                    if (!cryptoData) {
                        cryptoData = this.getCryptoFallbackData(cryptoItem.symbol);
                        fallbackCount++;
                        console.log(`‚ö†Ô∏è Using fallback crypto data for ${cryptoItem.symbol}`);
                    }
                    
                    if (cryptoData) {
                        const changeClass = parseFloat(cryptoData.changePercent) >= 0 ? 'positive' : 'negative';
                        const changeSymbol = parseFloat(cryptoData.changePercent) >= 0 ? '+' : '';
                        
                        const dataIndicator = cryptoData.isReal ? 
                            '<span class="real-data-indicator">‚óè</span>' : 
                            '<span class="fallback-indicator">‚óè</span>';
                        
                        items.push(`
                            <div class="stock-item">
                                <span class="stock-symbol">${cryptoData.symbol}<span class="crypto-badge">CRYPTO</span>${dataIndicator}</span>
                                <span class="stock-price">$${cryptoData.price}</span>
                                <span class="stock-change ${changeClass}">
                                    ${changeSymbol}${cryptoData.changePercent}%
                                </span>
                            </div>
                        `);
                    }
                    
                    // Delay between crypto API calls
                    if (i < this.cryptoSymbols.length - 1) {
                        console.log(`‚è±Ô∏è Waiting 12 seconds before next crypto API call...`);
                        await new Promise(resolve => setTimeout(resolve, 12000));
                    }
                }

                // Add final news item
                items.push(`
                    <div class="news-item">
                        <span class="news-icon">üì∞</span>
                        <span class="news-text">${this.news[(this.newsIndex + 1) % this.news.length]}</span>
                    </div>
                `);

                console.log(`=== ‚úÖ MONEY & FINANCE UPDATE COMPLETE ===`);
                console.log(`üìä Real data sources: ${this.realDataCount}/${this.totalSymbols}`);
                console.log(`‚ö†Ô∏è Fallback data used: ${fallbackCount}/${this.totalSymbols}`);
                console.log(`üéØ Success rate: ${((this.realDataCount/this.totalSymbols)*100).toFixed(1)}%`);
                
                // Create seamless loop - duplicate content 2 times for smooth transition
                const content = items.join('');
                this.tickerContent.innerHTML = content + content;
            }

            updateMarketStatus() {
                const now = new Date();
                const timeStr = now.toLocaleTimeString('en-US', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    timeZone: 'America/New_York'
                });
                
                const dataQuality = this.totalSymbols > 0 ? 
                    `${this.realDataCount}/${this.totalSymbols} REAL` : 'LOADING';
                
                this.marketStatus.textContent = `üìä MONEY & FINANCE ‚Ä¢ ${dataQuality} ‚Ä¢ ${timeStr} EST`;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Money & Finance Real-Time Ticker Starting...');
            new AlphaVantageOnlyTicker();
        });
    </script>
</body>
</html>
